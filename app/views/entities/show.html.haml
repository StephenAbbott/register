= render partial: 'shared/search_bar'

.content
  .container-fluid
    .entity-header
      .row
        .col-lg-12
          .meta.clearfix
            .row
              .col-lg-12
                .entity-name-wrap
                  %h1.entity-name= @entity.name
            - if @entity.natural_person?
              .row
                - @entity.country.try(:nationality).try do |nationality|
                  .col-lg-3
                    %h6= t(".fields.nationality")
                    %p
                      = entity_country_flag(@entity)
                      = nationality
                - @entity.country_of_residence.try do |country_of_residence|
                  .col-lg-3
                    %h6= t(".fields.country_of_residence")
                    %p= country_of_residence
                - @entity.address.try do |address|
                  .col-lg-3
                    %h6= t(".fields.address")
                    %p= address
                - date_of_birth(@entity).presence.try do |date_of_birth|
                  .col-lg-3
                    %h6= t(".fields.date_of_birth")
                    %p= date_of_birth
            - else
              .row
                - entity_jurisdiction(@entity).try do |entity_jurisdiction|
                  .col-lg-6
                    %h6= t(".fields.jurisdiction")
                    %p
                      = entity_country_flag(@entity)
                      = entity_jurisdiction
                - @entity.address.try do |address|
                  .col-lg-6
                    %h6= t(".fields.address")
                    %p= address
              .row
                - @entity.company_number.try do |company_number|
                  .col-lg-3
                    %h6= t(".fields.company_number")
                    %p= company_number
                - @entity.company_type.try do |company_type|
                  .col-lg-3
                    %h6= t(".fields.company_type")
                    %p= company_type
                - @entity.incorporation_date.try do |incorporation_date|
                  .col-lg-3
                    %h6= t(".fields.incorporation_date")
                    %p= incorporation_date
                - @entity.dissolution_date.try do |dissolution_date|
                  .col-lg-3
                    %h6= t(".fields.dissolution_date")
                    %p= dissolution_date

    .row
      .col-lg-6
        .ultimate-source-relationships
          - if @ultimate_source_relationship_groupings.empty?
            %h2.empty-entities
              = t(".controlling_entities_none_html", entity: render_haml("%span= @entity.name"))
          - else
            %h2
              = t(".controlling_entities_html", entity: render_haml("%span= @entity.name"))
            - @ultimate_source_relationship_groupings.each do |name, relationships|
              - if relationships.size > 1
                .grouping
                  %a.grouping-header{ 'aria-controls' => name.parameterize, 'aria-expanded' => 'false', 'data-toggle' => 'collapse', 'href' => '#' + name.parameterize }
                    = name
                    %small.grouping-size.pull-right
                      = t(".instances", count: relationships.size)
                  .collapse{ id: name.parameterize }
                    .note
                      = t(".note")
                    = render partial: 'ultimate_source_relationship', collection: relationships, as: :relationship
              - else
                = render partial: 'ultimate_source_relationship', locals: { relationship: relationships.first }

      .col-lg-6
        .source-relationships
          - if @source_relationships.empty?
            %h2.empty-entities
              = t(".controlled_entities_none_html", entity: render_haml("%span= @entity.name"))
          - else
            %h2
              = t(".controlled_entities_html", entity: render_haml("%span= @entity.name"))
            - @source_relationships.sort_by { |relationship| relationship.target.name }.each do |relationship|
              .item
                = render partial: 'shared/entity_title', locals: { entity: relationship.target }
                = link_to entity_relationship_path(relationship.target, @entity), class: 'relationship-link' do
                  = render partial: 'shared/relationship_interests', locals: { relationship: relationship }
                  %span.details
                    = t(".details")
