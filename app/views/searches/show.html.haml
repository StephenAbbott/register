- content_for(:title, %("#{params[:q]}")) if params[:q].present?

.content.search-content
  .container-fluid

    .row
      .col-lg-12
        %h1= t(".headline")
        - if params[:q].blank?
          %p.legal-entity-count= t(".legal-entity_count", count: number_to_human(@legal_entity_count, precision: 2).downcase)
      .col-lg-6.offset-lg-3
        .form-group
          = form_tag search_path, method: 'get', class: 'search-form' do
            = text_field_tag :q, params[:q], class: 'form-control form-control-lg search-field', placeholder: t(".placeholder"), autofocus: true

            = submit_tag t(".search"), name: nil, class: 'search-button'

    .row
      - if params[:q].blank?
        .col-lg-6.offset-lg-3
          .oo-intro
            %p= t(".blurb_html", bo_link: link_to(t('.bo_link_text'), glossary_path), more_info_link: link_to(t('.more_info_link_text'), faq_path))

            %hr

            .data-sources-info
              %p= t(".data_sources_preface", count: number_with_delimiter(@legal_entity_count))
              %ul.list-unstyled
                %li= link_to('UK PSC Register', 'http://download.companieshouse.gov.uk/en_pscdata.html', target: '_blank')
                %li= link_to('Denmark Central Business Register (CVR)', 'https://cvr.dk', target: '_blank')
                %li= link_to('Slovakia Public Sector Partners Register', 'https://rpvs.gov.sk/', target: '_blank')
                %li= link_to('Ukraine Unified States Register (EDR)', 'http://data.gov.ua/passport/73cfe78e-89ef-4f06-b3ab-eb5f16aea237', target: '_blank')
                %li EITI pilot data
                %li User submissions

            %hr

            - if user_signed_in?
              %p
                = link_to "Add your company’s beneficial ownership", submissions_path, class: 'btn btn-primary'
            - else
              %p
                = link_to "Sign up to add your company’s beneficial ownership", new_user_registration_path, class: 'btn btn-primary'
              %p
                Already signed up?
                = link_to "Sign in here", new_user_session_path

      - elsif @response.results.total.zero?
        .col-lg-6.offset-lg-3
          .no-results
            %p= t(".no_results")
      - else
        .col-lg-7.offset-lg-1
          .frame
            .frame-wrap
              %p.search-results-header
                - if @fallback
                  %em= t(".fallback", query: params[:q])
                  %br
                = page_entries_info @response.results, entry_name: 'result'
              .options
                .option-transliterate
                  = transliteration_action(@should_transliterate)

              %ul.list-unstyled.list-entities
                - @response.records.to_a.each do |record|
                  %li.item
                    = render "shared/entity_title", entity: decorate(record), with_company: true
                    - if record.natural_person?
                      .result-controls
                        :ruby
                          controls = record.relationships_as_source
                            .sort_by { |relationship| relationship.target.name }
                            .map { |relationship| link_to relationship.target.name, entity_path(relationship.target) }
                        Controls:
                        = safe_join controls, ', '

              = paginate @response.results

      .col-lg-3
        - unless params[:q].blank? || @response.results.empty?
          = render partial: 'filter', locals: { key: 'type', helper: method(:search_filter_type) }
          = render partial: 'filter', locals: { key: 'country', helper: method(:search_filter_country) }
